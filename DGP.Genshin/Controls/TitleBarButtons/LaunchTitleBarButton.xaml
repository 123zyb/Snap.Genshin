<ui:TitleBarButton xmlns:ui="http://schemas.modernwpf.com/2019"
                   x:Class="DGP.Genshin.Controls.TitleBarButtons.LaunchTitleBarButton"
                   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
                   xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
                   xmlns:s="clr-namespace:DGP.Genshin.Controls.Infrastructures.SmoothScrollViewer" 
                   xmlns:c="clr-namespace:DGP.Genshin.Controls.Converters"
                   mc:Ignorable="d" 
                   IsActive="{Binding IsActive,RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=Window}}" 
                   Width="NaN" Padding="16,0" FontFamily="Microsoft YaHei UI" 
                   Content="启动游戏"
                   Command="{Binding OpenUICommand}"
                   CommandParameter="{Binding RelativeSource={RelativeSource Self}}">
    <ui:FlyoutBase.AttachedFlyout>
        <ui:Flyout Placement="Bottom" Closed="Flyout_Closed">
            <Grid>
                <Grid.Resources>
                    <c:BooleanToVisibilityRevertConverter x:Key="BooleanToVisibilityRevertConverter"/>
                </Grid.Resources>
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"/>
                    <RowDefinition Height="auto"/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="在游戏内切换账号后打开此面板会自动检测新的账号"/>
                    <s:SmoothScrollViewer Grid.Row="1" MaxHeight="120" Margin="0,12,0,0">
                        <ui:ListView 
                        ItemsSource="{Binding Accounts}" 
                        SelectedItem="{Binding SelectedAccount}"
                        SelectionMode="Single"
                        DisplayMemberPath="Name"/>
                    </s:SmoothScrollViewer>
                </Grid>
                <Button Grid.Row="1" Content="删除选中的账号" HorizontalAlignment="Stretch" Command="{Binding DeleteAccountCommand}"/>
                <StackPanel Grid.Row="2" Margin="0,12,0,0">
                    <ComboBox
                          HorizontalAlignment="Stretch" 
                          ItemsSource="{Binding KnownSchemes}"
                          SelectedItem="{Binding CurrentScheme}"
                          DisplayMemberPath="Name"/>
                    <Grid Margin="0,12,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Row="0" Grid.Column="0" Content="启动游戏本体" HorizontalAlignment="Stretch" Margin="0,0,6,0"
                                Command="{Binding LaunchCommand}" CommandParameter="Game"/>
                        <Button Grid.Row="0" Grid.Column="1" Content="打开启动器" HorizontalAlignment="Stretch" Margin="6,0,0,0"
                                Command="{Binding LaunchCommand}" CommandParameter="Launcher"/>
                        <ui:ToggleSwitch Grid.Row="1" Grid.Column="0" Header="无边框" Margin="0,8,6,0" IsOn="{Binding IsBorderless}"/>
                        <ui:ToggleSwitch Grid.Row="1" Grid.Column="1" Header="全屏" Margin="6,8,0,0" IsOn="{Binding IsFullScreen}"/>
                        <ui:ToggleSwitch Grid.Row="2" Grid.Column="0" Header="解锁帧率上限" Margin="0,8,6,0" IsOn="{Binding UnlockFPS}"/>
                        <Slider Grid.Row="3" Grid.ColumnSpan="2" Margin="6,8,0,0" TickFrequency="1" IsSnapToTickEnabled="True"
                                ui:ControlHelper.Header="{Binding RelativeSource={RelativeSource Self},Path=Value}"  Minimum="60" Maximum="360" Value="{Binding TargetFPS}"/>

                        <Border Grid.Row="2" Grid.RowSpan="2" Grid.ColumnSpan="2" 
                                Visibility="{Binding IsElevated,Converter={StaticResource BooleanToVisibilityRevertConverter}}"
                                Background="{StaticResource SystemControlBackgroundAltMediumBrush}">
                            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="需要 Snap Genshin&#10;以管理员模式启动" TextAlignment="Center"/>
                        </Border>
                    </Grid>
                    
                </StackPanel>
            </Grid>
        </ui:Flyout>
    </ui:FlyoutBase.AttachedFlyout>
</ui:TitleBarButton>
